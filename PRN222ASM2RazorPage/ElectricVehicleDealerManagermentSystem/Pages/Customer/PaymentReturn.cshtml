@page "/Customer/PaymentReturn"
@model ElectricVehicleDealerManagermentSystem.Pages.Customer.PaymentReturnModel
@{
    ViewData["Title"] = "Payment Processing";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-body text-center p-5">
                    <div class="text-info mb-4">
                        <i class="fas fa-spinner fa-spin fa-4x"></i>
                    </div>
                    
                    <h3 class="text-info mb-3">Processing Payment...</h3>
                    
                    <p class="lead mb-4">
                        Please wait while we process your payment. You will be redirected automatically.
                    </p>

                    <div class="alert alert-info" role="alert">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Please do not close this page or navigate away.</strong>
                    </div>

                    <!-- Debug Information -->
                    <div class="mt-4" style="display: none;" id="debugInfo">
                        <h6>Debug Information:</h6>
                        <p id="debugText"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Payment processing...');
            
            // Show debug info
            const urlParams = new URLSearchParams(window.location.search);
            const debugInfo = document.getElementById('debugInfo');
            const debugText = document.getElementById('debugText');
            
            if (urlParams.has('vnp_ResponseCode')) {
                debugInfo.style.display = 'block';
                debugText.innerHTML = `
                    Response Code: ${urlParams.get('vnp_ResponseCode')}<br>
                    Order Info: ${urlParams.get('vnp_OrderInfo')}<br>
                    Transaction ID: ${urlParams.get('vnp_TransactionNo')}<br>
                    Amount: ${urlParams.get('vnp_Amount')}
                `;
                console.log('VNPay callback detected with params:', Object.fromEntries(urlParams));
            }
            
            // Optional: Add a timeout to redirect to MyOrders if something goes wrong
            setTimeout(function() {
                if (window.location.pathname.includes('/PaymentReturn')) {
                    console.log('Redirecting to MyOrders due to timeout');
                    window.location.href = '/Customer/MyOrders';
                }
            }, 10000); // 10 second timeout
        });
    </script>
}